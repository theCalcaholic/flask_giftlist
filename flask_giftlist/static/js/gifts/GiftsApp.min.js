angular.module("GiftsApp",["ngRoute","ngMessages","ngCookies"]).config(["$routeProvider","$locationProvider",function(t,i){t.when("/",{templateUrl:"ajax/template/giftList.html",controller:"GiftListCtrl",controllerAs:"giftList"}).when("/claim/",{templateUrl:"ajax/template/claimGift.html",controller:"ClaimGiftCtrl",controllerAs:"vm"}),i.html5Mode(!0)}]),function(){ClaimGiftCtrl=function(t){this.gift=t.selectedGift,this.gifter=t.gifter,this.showMailText=!0,this.submitClaim=function(){t.selectedGift=this.gift,t.claimGift(t.selectedIndex)}},angular.module("GiftsApp").controller("ClaimGiftCtrl",["DataProvider",ClaimGiftCtrl])}(),function(){GiftListCtrl=function(t,i,e,r){this.gifts=i.gifts,this.loggedIn=!1,this.notifications=r.notifications;this.claimGift=function(t){i.selectedIndex=t,e.showClaimDialog()},this.editGift=function(t){void 0!==t?i.selectedIndex=t:i.selectedGift=i.addGift(),e.showEditDialog()},this.deleteGift=function(t){i.selectedIndex=t,e.showDeleteDialog()},this.closeDialog=function(){this.showForm=null},this.update=function(){i.updateGifts().then(function(){console.log("update permanent?"),console.log(i.gifts)}.bind(this))},this.resolve=function(){i.updateGifts()},this.notify=function(){r.flashMessage({msg:"Some random message."})},i.addListener(function(){this.gifts=i.gifts}.bind(this)),this.update()},angular.module("GiftsApp").controller("GiftListCtrl",["$scope","DataProvider","Dialogs","Notify",GiftListCtrl])}(),function(){ClaimDialogCtrl=function(t,i,e){this.shown=!1,this.gifter=i.gifter,this.show=function(){this.shown=!0},this.close=function(){this.shown=!1},this.submit=function(){this.form.$valid&&(t.path("/claim/"),this.close(),i.gifter=this.gifter),this.form.$setDirty()},validString=function(t){return t?"valid":"invalid"},this.debug=function(){this.gifter.surname="Tobias",this.gifter.lastname="Knöppler",this.gifter.email="tobias@knoeppler.net",this.gifter.email_confirm="tobias@knoeppler.net"},e.claimDialog(this)},ClaimDialogDirective=function(){return{restrict:"EA",templateUrl:"ajax/template/claimDialog.html",replace:!0,transclude:!1,controller:ClaimDialogCtrl,controllerAs:"dialog"}},angular.module("GiftsApp").directive("claimdialog",["$location","DataProvider","Dialogs",ClaimDialogDirective])}(),function(){DeleteDialogCtrl=function(t,i){this.shown=!1,this.gift=t.selectedGift,this.name="delete",thiz=this,this.show=function(){this.gift=t.selectedGift,this.shown=!0},this.close=function(){this.shown=!1},this.submit=function(){this.form.$valid?(this.close(),this.form.$setPristine(),t.selectedGift=this.gift,t.deleteGift(t.selectedIndex)):this.form.$setDirty()},validString=function(t){return t?"valid":"invalid"},thiz.debug=function(){},i.deleteDialog(this)},DeleteDialogDirective=function(){return{restrict:"E",templateUrl:"ajax/template/deleteDialog.html",replace:!0,scope:{},controller:["DataProvider","Dialogs",DeleteDialogCtrl],controllerAs:"dialog"}},angular.module("GiftsApp").directive("deleteDialog",DeleteDialogDirective)}(),function(){EditDialogCtrl=function(t,i,e,r){this.gift=e.selectedGift,this.shown=!1,this.name="edit",this.show=function(){this.shown=!0,this.gift=e.selectedGift,this.gift&&this.form.$setDirty()},this.close=function(){this.shown=!1},this.submit=function(){this.form.$valid?(this.close(),e.saveGift(e.selectedIndex),this.form.$setPristine()):this.form.$setDirty()},validString=function(t){return t?"valid":"invalid"},this.debug=function(){console.log(this.gift.imageFile),console.log(this.form.image),data=new FormData,data.append("imageFile",this.gift.imageFile),console.log(data)},r.editDialog(this)},EditDialogDirective=function(){return{restrict:"E",templateUrl:"ajax/template/editDialog.html",replace:!0,scope:{},controller:["$location","$http","DataProvider","Dialogs",EditDialogCtrl],controllerAs:"dialog"}},angular.module("GiftsApp").directive("editDialog",EditDialogDirective)}(),function(){EqualToDirective=function(){return{restrict:"A",require:"ngModel",scope:{compareValue:"=equalTo"},link:function(t,i,e,r){t.$watch("compareValue",function(){r.$validate()}),r.$validators.equalTo=function(i){return t.compareValue===i?!0:!1}}}},angular.module("GiftsApp").directive("equalTo",["$parse",EqualToDirective])}(),function(){FieldErrors=function(){return{restrict:"E",scope:{field:"=field"},templateUrl:"ajax/template/fieldErrorMsgs.html",replace:!0}},angular.module("GiftsApp").directive("fieldErrors",FieldErrors)}(),function(){GiftDirective=function(){return{restrict:"EA",templateUrl:"ajax/template/gift.html"}},angular.module("GiftsApp").directive("gift",GiftDirective)}(),function(){NotificationsCtrl=function(t,i){t.notifications=i.notifications,t.test="it works!",t.hideMessage=function(){i.hideMessage.bind(i)(),t.notifications=i.notifications}},NotificationsDirective=function(){return{restrict:"E",templateUrl:"ajax/template/notifications.html",replace:!0,transclude:!1,controller:["$scope","Notify",NotificationsCtrl]}},angular.module("GiftsApp").directive("notifications",NotificationsDirective)}(),function(){DataProvider=function(t,i,e,r,a){var o=[],n={surname:null,name:null,email:null},s=null,l=void 0;return this.identity="DataProviderfactory",DataProvider={},DataProvider.gifts=[],Object.defineProperty(DataProvider,"selectedGift",{get:function(){return void 0===l?null:"new"===l?s:DataProvider.gifts[l]},set:function(t){if(void 0===t)l=void 0;else if(t.id){if(s&&s.id==t.id)return l="new";for(var i=0;i<DataProvider.gifts.length;i++)(DataProvider.gifts[i].id=t.id)&&(l=i)}},configurable:!0}),DataProvider.gifter=n,Object.defineProperty(DataProvider,"selectedIndex",{get:function(){return l},set:function(t){void 0!==t&&("new"===t||t<DataProvider.gifts.length)&&(l=t)}}),DataProvider.saveGift=function(t){if(t&&"new"===t)gift=s,url="ajax/gift/"+gift.id+"/";else{if(!(t<DataProvider.gifts.length))return void a.flashMessage("Internal error: No such gift!");gift=DataProvider.gifts[t],url="ajax/gift/"+gift.id+"/save/"}data=new FormData,data.append("giftName",gift.giftName||""),data.append("prize",gift.prize||""),data.append("url",gift.url||""),data.append("description",gift.description||""),data.append("mailText",gift.mailText||""),data.append("image",gift.image||""),data.append("deleteImage",Boolean(gift.deleteImage)),gift.imageFile&&data.append("imageFile",gift.imageFile),i.post(url,data,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(i){i.errors.length?(a.flashMessage({msg:"Speichern fehlgeschlagen.",type:"error",subMsgs:i.errors}),l=t,r.showEditDialog()):(a.flashMessage({msg:"Erfolgreich gespeichert"}),console.log(this),DataProvider.updateGifts())}.bind(this)).error(function(i){a.flashMessage({msg:"Speichern fehlgeschlagen.",type:"error",subMsgs:i.errors}),l=t,r.showEditDialog()})},DataProvider.claimGift=function(t){n&&t<DataProvider.gifts.length&&(data=n,data.giftId=DataProvider.gifts[t].id,errorMsg="Beim reservieren des Geschenks ist ein Fehler aufgetreten. Bitte versuchen sie es noch einmal.",claimingMsgId=a.showMessage({msg:"Das Geschenk wird reserviert. Bitte warten...",type:"info"}),i.post("ajax/claim/"+DataProvider.gifts[t].id+"/",data).success(function(t){a.hideMessage(claimingMsgId),t.errors.length?a.flashMessage({msg:errorMsg,subMsgs:t.errors,type:"error",duration:5e3}):(a.flashMessage({msg:"Das Geschenk wurde reserviert.\n\rEine E-Mail mit allen wichtigen Informationen wurde an die angegebene E-Mail-Adresse versandt."}),e.path("/"))}).error(function(t){a.hideMessage(claimingMsgId),a.flashMessage({msg:errorMsg,subMsgs:t.errors,type:"error",duration:5e3})}))},DataProvider.deleteGift=function(t){i.post("ajax/gift/"+DataProvider.gifts[t].id+"/delete/").success(function(){a.flashMessage({msg:"Geschenk gelöscht."}),selectedIndex=void 0,DataProvider.updateGifts()}).error(function(i){a.flashMessage({msg:"Löschen fehlgeschlagen.",type:"error",duration:5e3,subMsgs:i.errors}),l=t})},DataProvider.retrieveGifts=function(){return t(void 0===DataProvider.gifts?function(){DataProvider.updateGifts().then(function(t){return t},function(i){return t.reject(i)})}:function(t){t(DataProvider.gifts)})},DataProvider.updateGifts=function(){return i.get("ajax/gifts/").success(function(t){gifts=t.gifts,DataProvider.gifts=gifts,console.log("gifts updated: "),console.log(DataProvider.gifts);for(index in o)o[index]();return DataProvider.gifts}).error(function(){return a.flashMessage({msg:"Die Geschenkliste konnte nicht geladen werden.",type:"error",duration:7e3}),t.reject(DataProvider.gifts)})},DataProvider.addGift=function(t){return s?null:s=void 0!==t?t:{id:"new",giftName:void 0,prize:void 0,url:"",description:void 0,mailText:void 0,image:void 0,imageFile:void 0}},DataProvider.giftById=function(t){if("new"===t&&s)return s;for(gift in DataProvider.gifts)if(gift.id===t)return gift;return null},DataProvider.addListener=function(t){o.push(t)},DataProvider},angular.module("GiftsApp").factory("DataProvider",["$q","$http","$location","Dialogs","Notify",DataProvider])}(),function(){Dialogs=function(){var t=null,i=null,e=null;return{editDialog:function(i){return void 0!==i&&(t=i),t},claimDialog:function(t){i=t},deleteDialog:function(t){return void 0!==t&&(e=t),e},showEditDialog:function(){t.show()},showClaimDialog:function(){i.show()},showDeleteDialog:function(){e.show()}}},angular.module("GiftsApp").factory("Dialogs",Dialogs)}(),Notify=function(t){var i=0;this.notifications={length:0},this.identity="notify",this.flashMessage=function(i){return itemId=this.showMessage(i),t(this.hideMessage.bind(this),i.duration,!0,itemId),itemId},this.showMessage=function(t){t=validateArguments(t),itemId=String(i),i++;var e={text:t.msg,type:t.type,subNotifications:t.subMsgs,id:itemId};return Object.defineProperty(this.notifications,itemId,{enumerable:!0,configurable:!0,value:e}),this.notifications.length++,itemId},this.hideMessage=function(t){delete this.notifications[String(t)],this.notifications.length--},validateArguments=function(t){if(!t)throw"missing parameters";if(!t.msg)throw"missing required parameter: msg";return t.type=t.type||"info",t.duration=t.duration||3e3,t.subMsgs=t.subMsgs||[],t}},angular.module("GiftsApp").service("Notify",["$timeout",Notify]);
